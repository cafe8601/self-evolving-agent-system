# Self-Evolving Agent Observability System

> ğŸ” Claude Code, OpenCode, MDFlow í†µí•© ê´€ì¸¡ì„± ì‹œìŠ¤í…œ

## ì•„í‚¤í…ì²˜ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     EVENT SOURCES                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Claude Code     â”‚    OpenCode       â”‚      MDFlow                â”‚
â”‚   (Hooks)         â”‚   (Agents)        â”‚    (Workflows)             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚ Session   â”‚   â”‚   â”‚ OmO       â”‚   â”‚   â”‚ evolve    â”‚           â”‚
â”‚   â”‚ PreTool   â”‚   â”‚   â”‚ oracle    â”‚   â”‚   â”‚ research  â”‚           â”‚
â”‚   â”‚ PostTool  â”‚   â”‚   â”‚ builder   â”‚   â”‚   â”‚ build     â”‚           â”‚
â”‚   â”‚ Stop      â”‚   â”‚   â”‚ librarian â”‚   â”‚   â”‚ review    â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OBSERVABILITY SERVER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ HTTP API    â”‚  â”‚  SQLite DB  â”‚  â”‚ Brain Sync  â”‚                 â”‚
â”‚  â”‚ :4100       â”‚  â”‚  (WAL Mode) â”‚  â”‚ Integration â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚         â”‚                â”‚                â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                          â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    WebSocket Stream                          â”‚   â”‚
â”‚  â”‚                    /stream                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DASHBOARD CLIENT                                  â”‚
â”‚  Terminal-based real-time monitoring                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ë¹ ë¥¸ ì‹œì‘

### 1. ì„œë²„ ì‹œì‘

```bash
# ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹œì‘
npm run obs:start

# í¬ê·¸ë¼ìš´ë“œì—ì„œ ì‹œì‘ (ë””ë²„ê¹…ìš©)
bash observability/scripts/start-server.sh --foreground
```

### 2. ìƒíƒœ í™•ì¸

```bash
npm run obs:status
```

### 3. ëŒ€ì‹œë³´ë“œ ì‹¤í–‰

```bash
npm run obs:dashboard
```

### 4. ì„œë²„ ì¤‘ì§€

```bash
npm run obs:stop
```

## NPM ìŠ¤í¬ë¦½íŠ¸

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `npm run obs:start` | ê´€ì¸¡ì„± ì„œë²„ ì‹œì‘ |
| `npm run obs:stop` | ê´€ì¸¡ì„± ì„œë²„ ì¤‘ì§€ |
| `npm run obs:status` | ì„œë²„ ìƒíƒœ ë° í†µê³„ í™•ì¸ |
| `npm run obs:dashboard` | í„°ë¯¸ë„ ëŒ€ì‹œë³´ë“œ ì‹¤í–‰ |
| `npm run obs:logs` | ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸ |

## API ì—”ë“œí¬ì¸íŠ¸

### ì´ë²¤íŠ¸

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| POST | `/events` | ìƒˆ ì´ë²¤íŠ¸ ìˆ˜ì‹  |
| GET | `/events/recent` | ìµœê·¼ ì´ë²¤íŠ¸ ì¡°íšŒ (limit, source, category íŒŒë¼ë¯¸í„°) |
| GET | `/events/session/:id` | ì„¸ì…˜ë³„ ì´ë²¤íŠ¸ ì¡°íšŒ |
| GET | `/events/filter-options` | í•„í„° ì˜µì…˜ ì¡°íšŒ |

### ë©”íŠ¸ë¦­

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/metrics/summary` | ì „ì²´ ë©”íŠ¸ë¦­ ìš”ì•½ |
| GET | `/metrics/agents` | ì—ì´ì „íŠ¸ ì„±ëŠ¥ ë©”íŠ¸ë¦­ |

### ì„¸ì…˜

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/sessions/active` | í™œì„± ì„¸ì…˜ ëª©ë¡ |
| GET | `/sessions/:id` | ì„¸ì…˜ ìƒì„¸ ì •ë³´ |

### Brain í†µí•©

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/brain/state` | Brain ìƒíƒœ ì¡°íšŒ |
| GET | `/brain/workflows` | ì›Œí¬í”Œë¡œìš° í†µê³„ |
| GET | `/brain/patterns` | ìµœê·¼ í•™ìŠµ íŒ¨í„´ |
| POST | `/brain/patterns` | ìƒˆ íŒ¨í„´ ê¸°ë¡ |

### ì‹œìŠ¤í…œ

| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| GET | `/health` | í—¬ìŠ¤ì²´í¬ |
| GET | `/system/stats` | ë°ì´í„°ë² ì´ìŠ¤ í†µê³„ |
| POST | `/system/cleanup` | ì˜¤ë˜ëœ ë°ì´í„° ì •ë¦¬ |

### WebSocket

| Endpoint | ì„¤ëª… |
|----------|------|
| `/stream` | ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ |

## ì´ë²¤íŠ¸ íƒ€ì…

### Claude Code

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `SessionStart` | ì„¸ì…˜ ì‹œì‘ |
| `UserPromptSubmit` | ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì œì¶œ |
| `PreToolUse` | ë„êµ¬ ì‚¬ìš© ì „ |
| `PostToolUse` | ë„êµ¬ ì‚¬ìš© í›„ (ì„±ê³µ) |
| `PostToolUseFailure` | ë„êµ¬ ì‚¬ìš© í›„ (ì‹¤íŒ¨) |
| `Stop` | ì„¸ì…˜ ì¢…ë£Œ |

### OpenCode

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `AgentStart` | ì—ì´ì „íŠ¸ ì‹œì‘ |
| `AgentComplete` | ì—ì´ì „íŠ¸ ì™„ë£Œ |
| `AgentError` | ì—ì´ì „íŠ¸ ì˜¤ë¥˜ |
| `AgentDelegate` | ì—ì´ì „íŠ¸ ìœ„ì„ |

### MDFlow

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `WorkflowStart` | ì›Œí¬í”Œë¡œìš° ì‹œì‘ |
| `PhaseStart` | í˜ì´ì¦ˆ ì‹œì‘ |
| `PhaseComplete` | í˜ì´ì¦ˆ ì™„ë£Œ |
| `WorkflowComplete` | ì›Œí¬í”Œë¡œìš° ì™„ë£Œ |

### Brain Sync

| ì´ë²¤íŠ¸ | ì„¤ëª… |
|--------|------|
| `BrainSync` | Brain ë™ê¸°í™” |
| `PatternLearned` | íŒ¨í„´ í•™ìŠµë¨ |
| `PatternApplied` | íŒ¨í„´ ì ìš©ë¨ |

## íŒŒì¼ êµ¬ì¡°

```
observability/
â”œâ”€â”€ README.md               # ì´ ë¬¸ì„œ
â”œâ”€â”€ ARCHITECTURE.md         # ìƒì„¸ ì•„í‚¤í…ì²˜ ë¬¸ì„œ
â”‚
â”œâ”€â”€ server/                 # ê´€ì¸¡ì„± ì„œë²„
â”‚   â”œâ”€â”€ index.ts           # ë©”ì¸ ì„œë²„ (Bun)
â”‚   â”œâ”€â”€ db.ts              # SQLite ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ types.ts           # TypeScript íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ brain-sync.ts      # Brain í†µí•© ëª¨ë“ˆ
â”‚   â”œâ”€â”€ package.json       # ì„œë²„ ì˜ì¡´ì„±
â”‚   â””â”€â”€ observability.db   # SQLite ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼
â”‚
â”œâ”€â”€ hooks/                  # Hook ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ send-event.ts      # ë²”ìš© ì´ë²¤íŠ¸ ì „ì†¡ê¸°
â”‚   â”œâ”€â”€ observability-wrapper.sh    # Claude Code Hook ë˜í¼
â”‚   â”œâ”€â”€ opencode-wrapper.sh         # OpenCode Hook ë˜í¼
â”‚   â”œâ”€â”€ opencode-agent-hook.ts      # OpenCode ì—ì´ì „íŠ¸ Hook
â”‚   â””â”€â”€ mdflow-wrapper.sh           # MDFlow Hook ë˜í¼
â”‚
â”œâ”€â”€ scripts/                # ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸
â”‚   â”œâ”€â”€ start-server.sh    # ì„œë²„ ì‹œì‘
â”‚   â”œâ”€â”€ stop-server.sh     # ì„œë²„ ì¤‘ì§€
â”‚   â””â”€â”€ status.sh          # ìƒíƒœ í™•ì¸
â”‚
â”œâ”€â”€ client/                 # í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ dashboard.ts       # í„°ë¯¸ë„ ëŒ€ì‹œë³´ë“œ
â”‚
â””â”€â”€ learning/               # ìë™ í•™ìŠµ
    â””â”€â”€ pattern-detector.ts # íŒ¨í„´ ìë™ ê°ì§€
```

## ìë™ íŒ¨í„´ ê°ì§€

ê´€ì¸¡ì„± ì‹œìŠ¤í…œì€ ì´ë²¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ìë™ìœ¼ë¡œ í•™ìŠµ íŒ¨í„´ì„ ê°ì§€í•©ë‹ˆë‹¤:

```bash
# íŒ¨í„´ ê°ì§€ ì‹¤í–‰
cd observability/learning && bun run pattern-detector.ts

# ê°ì§€ëœ íŒ¨í„´ í™•ì¸
npm run brain:status

# Brainì— ë³‘í•©
npm run brain:sync
```

### ê°ì§€ ê°€ëŠ¥í•œ íŒ¨í„´

| íŒ¨í„´ íƒ€ì… | ì„¤ëª… |
|-----------|------|
| FAILURE_PATTERN | ë†’ì€ ì‹¤íŒ¨ìœ¨ì„ ë³´ì´ëŠ” ë„êµ¬ |
| SUCCESS_PATTERN | ì„±ê³µì ì¸ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ |
| WARNING | ì„±ëŠ¥ ì´ìƒ ê°ì§€ (>10ì´ˆ) |
| DISCOVERY | ìƒˆë¡œìš´ ë„êµ¬ ì¡°í•© ë°œê²¬ |

## ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜

| ë³€ìˆ˜ | ê¸°ë³¸ê°’ | ì„¤ëª… |
|------|--------|------|
| `OBSERVABILITY_URL` | `http://localhost:4100/events` | ì„œë²„ URL |

### Claude Code Hook ì„¤ì •

`.claude/settings.json`ì—ì„œ Hookì´ ìë™ êµ¬ì„±ë©ë‹ˆë‹¤:

```json
{
  "hooks": {
    "SessionStart": [...],
    "UserPromptSubmit": [...],
    "PreToolUse": [...],
    "PostToolUse": [...],
    "PostToolUseFailure": [...],
    "Stop": [...]
  }
}
```

## Brain í†µí•©

ê´€ì¸¡ì„± ì‹œìŠ¤í…œì€ `project_brain.yaml`ê³¼ ìë™ìœ¼ë¡œ í†µí•©ë©ë‹ˆë‹¤:

1. **ë©”íŠ¸ë¦­ ìˆ˜ì§‘**: ë„êµ¬ ì‚¬ìš©, ì„±ê³µë¥ , í† í° ì‚¬ìš©ëŸ‰
2. **íŒ¨í„´ ê°ì§€**: ì‹¤íŒ¨/ì„±ê³µ íŒ¨í„´ ìë™ ì‹ë³„
3. **í•™ìŠµ ë™ê¸°í™”**: ì„¸ì…˜ ì¢…ë£Œ ì‹œ ìë™ Brain ì—…ë°ì´íŠ¸

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ

```bash
# ë¡œê·¸ í™•ì¸
cat .observability.log

# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :4100

# ìˆ˜ë™ ì‹œì‘ ì‹œë„
cd observability/server && bun run index.ts
```

### Hookì´ ì‘ë™í•˜ì§€ ì•ŠìŒ

```bash
# Hook ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ í™•ì¸
ls -la observability/hooks/

# ìˆ˜ë™ í…ŒìŠ¤íŠ¸
echo '{"session_id":"test"}' | bash observability/hooks/observability-wrapper.sh claude-code TestEvent
```

### ì´ë²¤íŠ¸ê°€ ìˆ˜ì‹ ë˜ì§€ ì•ŠìŒ

```bash
# ì„œë²„ ìƒíƒœ í™•ì¸
curl http://localhost:4100/health

# ìˆ˜ë™ ì´ë²¤íŠ¸ ì „ì†¡ í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:4100/events \
  -H "Content-Type: application/json" \
  -d '{"source_app":"test","session_id":"test","event_type":"Test","payload":{}}'
```

## ê´€ë ¨ ë¬¸ì„œ

- [ARCHITECTURE.md](./ARCHITECTURE.md) - ìƒì„¸ ì•„í‚¤í…ì²˜ ë¬¸ì„œ
- [project_brain.yaml](../.opencode/brain/project_brain.yaml) - í•™ìŠµ íŒ¨í„´ ì €ì¥ì†Œ
- [learning-loop.md](../.claude/rules/learning-loop.md) - í•™ìŠµ ë£¨í”„ ê·œì¹™
